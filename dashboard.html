<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic QR - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Dynamic QR</h1>
            <nav>
                <a href="index.html">Create</a>
                <a href="dashboard.html" class="active">Dashboard</a>
            </nav>
        </header>

        <main>
            <div class="card">
                <h2>Your QR Codes</h2>
                <p class="subtitle">Manage all your dynamic QR codes</p>
                
                <div id="loading" class="loading">Loading...</div>
                <div id="emptyState" class="empty-state hidden">
                    <p>No QR codes yet. <a href="index.html">Create your first one!</a></p>
                </div>
                
                <div id="qrList" class="qr-list"></div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBaJXCqGmUaGumvcWNE7w4FOOzTJVDH-yg",
            authDomain: "polorfriends.firebaseapp.com",
            projectId: "polorfriends",
            storageBucket: "polorfriends.firebasestorage.app",
            messagingSenderId: "328546525972",
            appId: "1:328546525972:web:a6fe0f0a45b4565a7b1801",
            measurementId: "G-07B4713DQQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function formatDate(timestamp) {
            if (!timestamp) return 'Just now';
            const date = timestamp.toDate();
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }

        async function loadQRCodes() {
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('emptyState');
            const qrList = document.getElementById('qrList');
            
            try {
                const q = query(collection(db, 'qrcodes'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);
                
                loading.classList.add('hidden');
                
                if (querySnapshot.empty) {
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const item = createQRItem(data);
                    qrList.appendChild(item);
                });
                
            } catch (error) {
                console.error('Error loading QR codes:', error);
                loading.textContent = 'Failed to load QR codes';
            }
        }

        function createQRItem(data) {
            const item = document.createElement('div');
            item.className = 'qr-item';
            item.onclick = () => window.location.href = `edit.html?id=${data.id}`;
            
            const title = data.title || 'Untitled';
            const text = data.text || 'No content';
            const date = formatDate(data.createdAt);
            
            item.innerHTML = `
                <div class="qr-item-header">
                    <span class="qr-item-id">${data.id}</span>
                    <span class="qr-item-date">${date}</span>
                </div>
                <div class="qr-item-title">${title}</div>
                <div class="qr-item-text">${text}</div>
            `;
            
            return item;
        }

        loadQRCodes();
    </script>
</body>
</html>
